[XWORKSPACE](/README.md) > Bash

# BASH #

- [1. Bash Files](#1-download-and-install)
    - [1.1 .bash_profile](#11-background)
    - [1.2 .profile](#12-purpose)
    - [1.3 .bashrc](#13-history)
- [2. SSH](#2-ssh)
    - [2.1 Start SSH Agent](#21-start-ssh-agent)
    - [2.2 Create SSH Key for Git](#22-create-ssh-key-for-git)
        - [2.2.1 Generate Keys](#221-generate-keys)
        - [2.2.2 Attach Keys to Git Accounts](#222-attach-keys-to-git-accounts)
        - [2.2.3 Test Keys](#223-test-keys)
        - [2.2.4 Try Git](#224-try-git)
- [3. Global Variables](#3-global-variables)
    - [3.1 XWSROOT](#31-xwsroot)
    - [3.2 PATH](#32-path)
- [4. Global Functions](#4-global-functions)
- [5. Alias](#5-alias)
    - [5.1 Common Alias](#51-common-alias)
    - [5.2 Git Alias](#52-git-alias)

## 1. Bash Files

### 1.1 .bash_profile

This file (`.bash_profile`) is under user's home directory ("`~/.bash_profile`"). The content is:

```bash
# generated by Git for Windows
test -f ~/.profile && . ~/.profile
test -f ~/.bashrc && . ~/.bashrc
```

### 1.2 .profile

This should be auto-generated by Git-Bash

### 1.3 .bashrc

This file ("`.bashrc`") is under user's home directory ("`~/.bashrc`"). It includes:

- Initialization script
- Global functions
- Global variables
- Alias

## 2. SSH

### 2.1 Start SSH Agent

Add following code at begining of file "`.bashrc`".

```bash
#
# Enable SSH
#
SSH_ENV=$HOME/.ssh/environment
  
# Start the ssh-agent
function start_ssh_agent {
    echo "Initializing SSH agent..."
    # spawn ssh-agent
    /usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
    echo "Succeeded"
    chmod 600 "${SSH_ENV}"
    . "${SSH_ENV}" > /dev/null
    /usr/bin/ssh-add ~/.ssh/id_rsa_1
    /usr/bin/ssh-add ~/.ssh/id_rsa_2
    ...
    /usr/bin/ssh-add ~/.ssh/id_rsa_N
}
  
if [ -f "${SSH_ENV}" ]; then
     . "${SSH_ENV}" > /dev/null
	 ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
	    start_ssh_agent;
	}
else
    start_ssh_agent;
fi
```

### 2.2 Create SSH Key for Git

User may have more than one git accounts from same git service provider. So here is an example which creates keys for three accounts.

- Company Account (email):  username@company.com
- Personal Account (email): username@gmail.com
- Private Account (email):  username@hotmail.com

#### 2.2.1 Generate Keys

Use following command to create SSH keys for both users.

```bash
ssh-keygen -t rsa -C "username@company.com" -f ~/.ssh/id_rsa_company
ssh-keygen -t rsa -C "username@gmail.com" -f ~/.ssh/id_rsa_personal
ssh-keygen -t rsa -C "username@gmail.com" -f ~/.ssh/id_rsa_private
```

Above command will generate following files:

```bash
~/.ssh/id_rsa_company
~/.ssh/id_rsa_company.pub
~/.ssh/id_rsa_personal
~/.ssh/id_rsa_personal.pub
~/.ssh/id_rsa_private
~/.ssh/id_rsa_private.pub
```

#### 2.2.2 Attach Keys to Git Accounts

Create ssh config file - "`~/.ssh/config`". The content is:

```
Host company
    HostName bitbucket.org
    User <username>
    IdentityFile ~/.ssh/id_rsa_company
Host personal
    HostName github.com
    User <username>
    IdentityFile ~/.ssh/id_rsa_personal
Host private
    HostName bitbucket.org
    User <username>
    IdentityFile ~/.ssh/id_rsa_private
```

Upload following public keys to server (bitbucket.org & github.com)

#### 2.2.3 Test Keys

Run following commands to test keys:

```bash
ssh -T git@comapny
ssh -T git@personal
ssh -T git@private
```

    NOTE:
    From now on, user should always use host alias instead of real host name in git commands.
    For exampel,
        git clone https://username@company/username/company-project.git
        git clone https://username@personal/username/personal-repo.git
        git clone https://username@private/username/private-repo.git

#### 2.2.4 Try Git

*Test Tasks*

- Clone an existing repository
- Show its history
- Add a new markdown file

*Commands*

```bash
git clone git@company:username/company-project.git ./project-folder
cd project-folder
git log --pretty=format:%h - %an, %ar : %s
touch NewFile.md
git commit -am "Add a new Markdown file"
git push
```

## 3. Global Variables

### 3.1 XWSROOT

Export XWSROOT in "`.bashrc`" file:

```bash
export XWSROOT=<path/to/XWORKSPACE>
```

### 3.2 PATH

```bash
export PATH=$XWSROOT/bin:$PATH
```

## 4. Global Functions

Add following code to "`.bashrc`" file:

```bash
# lower-case string
xwstolower(){
    echo "$1" | sed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/"
}

# upper-case string
xwstoupper(){
    echo "$1" | sed "y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/"
}

# get os name
xwsgetos(){
    UNAMESTR=`xwstoupper \`uname -s\``
    if [[ "$UNAMESTR" == MINGW* ]]; then
        echo Windows
    elif [[ "$UNAMESTR" == *LINUX* ]]; then
        echo Linux
    elif [ "{$UNAMESTR}" == "{FREEBSD}" ]; then
        echo FreeBSD
    elif [[ "$UNAMESTR" == DARWIN* ]]; then
        echo Mac
    else
        echo Unknown
    fi
}
```

## 5. Alias

### 5.1 Common Alias

Add following alias in "`.bashrc`" file:

```bash
alias cdw='cd $XWSROOT'
```

### 5.2 Git Alias

Add following alias in "`.bashrc`" file:

```bash
# add all files: gitaa
alias gitaa='git add -A'
# disgard a file: gitdisgard <file>
alias gitdisgard='git checkout --'
# get status: gits
alias gits='git status'
# get repo remote url
alias giturl='git remote get-url --all origin'
# git pull (always rebase)
alias gitp='git pull --rebase'
# git pull master (always rebase)
alias gitpmaster='git pull --rebase origin master'
# git commit
alias gitc='git commit -a -m'
# git commit a file
alias gitcf='git commit -F'
# git diff file using p4v: gitp4d <file/name>
alias gitp4d='git difftool --no-prompt -t p4 --'
# git merge file using p4v: gitp4d <file/name>
alias gitp4m='git mergetool --no-prompt -t p4 --'
# git show all branches
alias gitshowbranches='git show-branch -a --topo-order --list'
# git show remote branches
alias gitshowremotebranches='git show-branch -r --topo-order --list'
# git show repo history
alias gith='git log --pretty=format:"%h - %an, %ar : %s"'
# git show file history
alias githf='git log --follow --pretty=format:"%h - %an, %ar : %s" --'
# git show repo history with diff
alias githd='git log -p --pretty=format:"%h - %an, %ar : %s"'
# git show file history with diff
alias githdf='git log --follow -p --pretty=format:"%h - %an, %ar : %s" --'
```
